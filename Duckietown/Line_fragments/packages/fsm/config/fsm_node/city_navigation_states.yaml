# FOR REFERENCE CHECK https://github.com/duckietown/dt-core/

initial_state: "LINE_FOLLOWING"

events:
  start_following:
    topic: "start_driving"
    msg_type: "BoolStamped"
    trigger: True

    adaptive_cruise_control_on:
      topic: "drive_controller_node" 
  red_line_detected:
    topic: "red_line_detection_node/red_line_detection" # Red line detection topic
    msg_type: "BoolStamped"
    trigger: True
#    turn_on_intersection:
#     topic: "~turn_on_intersection" # Turn topic
#     mgs_type: "BoolStamped"
#     trigger: False

nodes: 
  pid_node: "pid_controller_node/switch"
  acc_controller_node     : "acc_controller_node/switch"
  emergency_braking_node  : "emergency_braking_node/switch"

global_transmissions:
  red_line_detected: "STOPPED"
  # turning_on_intersection: "TURNING"
  line_following: "LINE_FOLLOWING" 

states:
  PARKED:
    activate_nodes:
      - pid_node
    lights: "GREEN"
  LINE_FOLLOWING: 
    activate_nodes:
      - pid_node
    lights: "CAR_DRIVING"
  STOPPED:
    active_nodes:
      - turn_decision_node # Initally randomizes the turn and send the signal to move from place, publishes for turning_node to activate
    lights: "RED"
  EMERGENCY_STOP:
    active_nodes:
      - emergency_braking_node
    lights: "RED"